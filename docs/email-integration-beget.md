# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–æ–∫ –∏–∑ email (Beget)

## –ü—Ä–æ–±–ª–µ–º–∞
–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–∏—Å—å–º–∞ –Ω–∞ info@–∫–ª–∏–Ω–∏–Ω–≥-–∫–æ—Å—Ç—Ä–æ–º–∞.—Ä—Ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Å–¥–µ–ª–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ "–ù–æ–≤—ã–µ" CRM.

## –†–µ—à–µ–Ω–∏—è

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å –Ω–∞ VPS (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ - –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ—á—Ç—É –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

1. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
   ```bash
   ssh root@155.212.191.59
   cd /opt/crm
   nano .env
   ```
   
   –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫–∏:
   ```env
   # Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   EMAIL_USER=info@–∫–ª–∏–Ω–∏–Ω–≥-–∫–æ—Å—Ç—Ä–æ–º–∞.—Ä—Ñ
   EMAIL_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–æ—Ç_–ø–æ—á—Ç—ã
   EMAIL_HOST=imap.beget.com
   WEBHOOK_API_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-12345
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**
   ```bash
   docker-compose -f docker-compose.prod.yml up -d --build email-listener
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker logs crm-email-listener -f
   ```

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–∏—Å—å–º–∞ –Ω–∞ info@–∫–ª–∏–Ω–∏–Ω–≥-–∫–æ—Å—Ç—Ä–æ–º–∞.—Ä—Ñ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ "–ù–æ–≤—ã–µ".

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Make.com (–µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–∞ VPS)

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://www.make.com/
   - –°–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è:**
   - –ù–∞–∂–º–∏—Ç–µ "Create a new scenario"
   - –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥—É–ª—å "Email" ‚Üí "Watch emails"
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ IMAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
     - Server: `imap.beget.com`
     - Port: `993`
     - Email: `info@–∫–ª–∏–Ω–∏–Ω–≥-–∫–æ—Å—Ç—Ä–æ–º–∞.—Ä—Ñ`
     - Password: –≤–∞—à –ø–∞—Ä–æ–ª—å
     - SSL: –≤–∫–ª—é—á–µ–Ω–æ
   
3. **–î–æ–±–∞–≤—å—Ç–µ HTTP –º–æ–¥—É–ª—å:**
   - "HTTP" ‚Üí "Make a request"
   - URL: `https://crm-kostroma.ru/api/webhooks/email`
   - Method: POST
   - Headers:
     - `Content-Type`: `application/json`
     - `x-api-key`: –≤–∞—à API –∫–ª—é—á (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ .env —Ñ–∞–π–ª–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
   - Body (JSON):
     ```json
     {
       "name": "{{1.from.name}}",
       "email": "{{1.from.address}}",
       "subject": "{{1.subject}}",
       "message": "{{1.text}}",
       "phone": ""
     }
     ```

4. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π** - –ø–∏—Å—å–º–∞ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—Ç—å –≤ CRM

---

### ‚öôÔ∏è –í–∞—Ä–∏–∞–Ω—Ç 2: PHP —Å–∫—Ä–∏–ø—Ç –Ω–∞ Beget (–¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–æ–≤–∞–Ω–Ω—ã—Ö)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `beget-email-forwarder.php` –∏–∑ –ø–∞–ø–∫–∏ docs:

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç** –Ω–∞ Beget —Ö–æ—Å—Ç–∏–Ω–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø–∞–ø–∫—É `/scripts/`)

2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```php
   $email = 'info@–∫–ª–∏–Ω–∏–Ω–≥-–∫–æ—Å—Ç—Ä–æ–º–∞.—Ä—Ñ';
   $password = '–≤–∞—à_–ø–∞—Ä–æ–ª—å';
   $apiKey = '–≤–∞—à_api_–∫–ª—é—á';
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ CRON –∑–∞–¥–∞—á—É** –≤ –ø–∞–Ω–µ–ª–∏ Beget:
   - –ü–µ—Ä–∏–æ–¥: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
   - –ö–æ–º–∞–Ω–¥–∞: `php /home/USERNAME/scripts/beget-email-forwarder.php`

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á** –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   ssh root@155.212.191.59
   cd /opt/crm
   echo "WEBHOOK_API_KEY=your-secret-key-here" >> .env
   docker-compose -f docker-compose.prod.yml restart next-app
   ```

---

### üìß –í–∞—Ä–∏–∞–Ω—Ç 3: Zapier (–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ —É–¥–æ–±–Ω—ã–π)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Make.com, –Ω–æ –ø–ª–∞—Ç–Ω—ã–π –ø–æ—Å–ª–µ 100 –æ–ø–µ—Ä–∞—Ü–∏–π/–º–µ—Å—è—Ü.

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å CRM

‚úÖ API endpoint –¥–ª—è email —É–∂–µ –≥–æ—Ç–æ–≤: `/api/webhooks/email`
‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
- name - –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞
- phone - —Ç–µ–ª–µ—Ñ–æ–Ω
- email - email –∫–ª–∏–µ–Ω—Ç–∞
- subject - —Ç–µ–º–∞ –ø–∏—Å—å–º–∞
- message - —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞

‚ùó –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å API –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
WEBHOOK_API_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Make.com** (–í–∞—Ä–∏–∞–Ω—Ç 1) - —ç—Ç–æ:
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 1000 –æ–ø–µ—Ä–∞—Ü–∏–π/–º–µ—Å—è—Ü
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ IMAP
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AI –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—Å—Ç–∞ –ø–∏—Å—å–º–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞, —Ç–∏–ø–∞ —É–±–æ—Ä–∫–∏ –∏ —Ç.–¥.
