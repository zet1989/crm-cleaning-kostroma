# AI –§—É–Ω–∫—Ü–∏–∏ –≤ CRM –±–µ–∑ n8n

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ AI** (`/settings` ‚Üí –≤–∫–ª–∞–¥–∫–∞ AI)
- üîë –í–≤–æ–¥ OpenRouter API –∫–ª—é—á–∞
- ü§ñ –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (GPT-4o, GPT-4o-mini, Claude, Gemini, Llama)
- üå°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
- ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook
- üéôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- –¢–∞–±–ª–∏—Ü–∞ `ai_settings` —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)
- –•—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π, –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏, –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ú–∏–≥—Ä–∞—Ü–∏—è: `supabase/migrations/20241209_ai_settings.sql`

### 3. **API Endpoints**

#### `/api/ai/test` - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞ OpenRouter
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏

#### `/api/ai/process-deal` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–¥–µ–ª–∫–∏
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å, –¥–∞—Ç—É, —Ü–µ–Ω—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î (–º–æ–¥–µ–ª—å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞)
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ webhook (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

#### `/api/ai/transcribe` - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç URL –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Whisper Large V3 —á–µ—Ä–µ–∑ OpenRouter
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–≤–æ–Ω–∫–∞—Ö (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏ webhook**

#### –ó–∞—è–≤–∫–∞ —Å —Å–∞–π—Ç–∞ ‚Üí `/api/webhooks/site`
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç –≤ `notes`
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AI
3. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ - –∑–∞–ø—É—Å–∫–∞–µ—Ç `/api/ai/process-deal`
4. AI –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å, –¥–∞—Ç—É, —Ü–µ–Ω—É
5. –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—è —Å–¥–µ–ª–∫–∏

#### –ó–≤–æ–Ω–æ–∫ ‚Üí `/api/webhooks/novofon`
1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–≤–æ–Ω–∫–µ
2. –°–æ–∑–¥–∞—ë—Ç —Å–¥–µ–ª–∫—É –≤ "–ù–æ–≤—ã–µ"
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AI
4. –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –∏ –≤–∫–ª—é—á–µ–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è:
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç `/api/ai/transcribe`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ `notes`
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç `/api/ai/process-deal`
5. AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ AI

### –°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É–º–º—ã —Å–¥–µ–ª–∫–∏
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É–±–æ—Ä–∫–∏
- ‚úÖ –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –∑–≤–æ–Ω–∫–æ–≤ (Whisper)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –º–æ–¥–µ–ª—å –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞

### –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å (–ª–µ–≥–∫–æ):
- üìä –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ–∑–∏—Ç–∏–≤/–Ω–µ–≥–∞—Ç–∏–≤/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ)
- üí¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞–º
- üè∑Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞—è–≤–æ–∫
- üéØ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞/—Å—Ä–æ—á–Ω–æ—Å—Ç–∏
- üìù –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
- üîç –ü–æ–∏—Å–∫ –¥—É–±–ª–µ–π –ø–æ —Å–º—ã—Å–ª—É (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π)
- üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä—É

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- Service role –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ webhook
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ n8n

‚úÖ **–ü—Ä–æ—â–µ –¥–µ–ø–ª–æ–π** - –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞  
‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ** - –ø—Ä—è–º—ã–µ API –≤—ã–∑–æ–≤—ã  
‚úÖ **–î–µ—à–µ–≤–ª–µ** - –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ n8n  
‚úÖ **–ù–∞–¥—ë–∂–Ω–µ–µ** - –º–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞  
‚úÖ **–£–¥–æ–±–Ω–µ–µ** - –≤—Å—ë –≤ –æ–¥–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ  
‚úÖ **–ì–∏–±—á–µ** - –ª—é–±–∞—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ TypeScript  

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. **AI –ø–æ–º–æ—â–Ω–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞** - –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **–£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - AI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
3. **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∫–∏–µ —Å–¥–µ–ª–∫–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ –∑–∞–∫—Ä–æ—é—Ç—Å—è
4. **–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∏—Å–µ–º/SMS –∫–ª–∏–µ–Ω—Ç–∞–º
5. **–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤** - –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω
6. **–ì–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å OpenRouter

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å **GPT-4o-mini**:
- –í—Ö–æ–¥—è—â–∏–π —Ç–æ–∫–µ–Ω: $0.15 / 1M —Ç–æ–∫–µ–Ω–æ–≤
- –ò—Å—Ö–æ–¥—è—â–∏–π —Ç–æ–∫–µ–Ω: $0.60 / 1M —Ç–æ–∫–µ–Ω–æ–≤
- ~1000 –∑–∞—è–≤–æ–∫ = ~$0.50-1.00

Whisper Large V3:
- ~$0.006 –∑–∞ –º–∏–Ω—É—Ç—É –∞—É–¥–∏–æ
- 100 –∑–≤–æ–Ω–∫–æ–≤ –ø–æ 5 –º–∏–Ω—É—Ç = ~$3

**–û—á–µ–Ω—å –¥—ë—à–µ–≤–æ** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —ç–∫–æ–Ω–æ–º–∏–µ–π –≤—Ä–µ–º–µ–Ω–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤! üéâ
